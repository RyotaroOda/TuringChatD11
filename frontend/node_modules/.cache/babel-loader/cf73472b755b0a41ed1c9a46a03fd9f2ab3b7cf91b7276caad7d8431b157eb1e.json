{"ast":null,"code":"import { ref, push, get, onValue, remove } from \"firebase/database\";\nimport { auth } from \"./firebase_f.ts\"; // Firebaseの認証インスタンスをインポート\nimport { db } from \"./firebase_f.ts\"; // Firebase初期化ファイルからデータベースをインポート\n\n// test_dataを取得する関数\nexport const getTestData = async () => {\n  try {\n    const testDataRef = db.ref(\"test_data\"); // 'test_data'ノードを参照\n    const snapshot = await testDataRef.once(\"value\"); // データを取得\n    if (snapshot.exists()) {\n      return snapshot.val(); // データが存在すればその内容を返す\n    } else {\n      console.log(\"test_dataが見つかりません。\");\n      return null;\n    }\n  } catch (error) {\n    console.error(\"test_dataの取得中にエラーが発生しました:\", error);\n    return null;\n  }\n};\n\n// ルームのデータを監視\nexport const onRoomUpdate = (roomId, callback) => {\n  const roomRef = ref(db, `rooms/${roomId}`);\n  onValue(roomRef, snapshot => {\n    const roomData = snapshot.val(); // RoomData型にキャスト\n    if (roomData) {\n      callback(roomData); // データがある場合はコールバックを呼び出す\n    } else {\n      console.error(\"ルームが存在しません。\");\n      callback(null);\n    }\n  }, error => {\n    console.error(\"ルームデータの監視中にエラーが発生しました:\", error);\n    callback(null);\n  });\n};\n\n// ルームデータを取得する関数\nexport const getRoomData = async roomId => {\n  try {\n    const roomRef = ref(db, `rooms/${roomId}`);\n    const snapshot = await get(roomRef);\n    if (snapshot.exists()) {\n      const roomData = snapshot.val();\n      return roomData; // RoomData型にキャストして返す\n    } else {\n      console.error(\"ルームが存在しません\");\n      return null;\n    }\n  } catch (error) {\n    console.error(\"ルームデータの取得に失敗しました:\", error);\n    return null;\n  }\n};\n\n// メッセージを送信する関数\nexport const sendMessage = async (roomId, message) => {\n  const user = auth.currentUser;\n  if (!user) {\n    throw new Error(\"ログインしていないユーザーです。\");\n  }\n  const messageRef = ref(db, `rooms/${roomId}/messages`);\n  const messageData = {\n    senderId: user.uid,\n    message,\n    timestamp: Date.now()\n  };\n  await push(messageRef, messageData);\n  console.log(\"メッセージを送信しました。\");\n};\n\n// バトルログの更新を監視するリスナー\nexport const onTurnUpdated = (roomId, callback) => {\n  const battleLogRef = ref(db, `rooms/${roomId}/battleLog`);\n\n  // バトルログの更新をリアルタイムで監視\n  onValue(battleLogRef, snapshot => {\n    const battleLogData = snapshot.val();\n    if (battleLogData) {\n      callback(battleLogData); // バトルログが更新されたらコールバックを実行\n    }\n  });\n};\n\n// バトル終了を監視するリスナー\nexport const onBattleEnd = (roomId, callback) => {\n  const statusRef = ref(db, `rooms/${roomId}/status`);\n\n  // バトルの終了を監視\n  onValue(statusRef, snapshot => {\n    const status = snapshot.val();\n    if (status === \"ended\") {\n      callback(); // バトルが終了したらコールバックを実行\n    }\n  });\n};\n\n// マッチング成立時、マッチングがキャンセルされた場合やリロード時にwaitingPlayersから削除する関数\nexport const removeFromWaitingList = async () => {\n  const user = auth.currentUser;\n  if (!user) {\n    throw new Error(\"ログインしていないユーザーです。\");\n  }\n  const playerId = user.uid;\n  const playerRef = ref(db, \"waitingPlayers/\" + playerId);\n  await remove(playerRef); // 待機リストからプレイヤーを削除\n  console.log(\"プレイヤーを待機リストから削除しました。\");\n};","map":{"version":3,"names":["ref","push","get","onValue","remove","auth","db","getTestData","testDataRef","snapshot","once","exists","val","console","log","error","onRoomUpdate","roomId","callback","roomRef","roomData","getRoomData","sendMessage","message","user","currentUser","Error","messageRef","messageData","senderId","uid","timestamp","Date","now","onTurnUpdated","battleLogRef","battleLogData","onBattleEnd","statusRef","status","removeFromWaitingList","playerId","playerRef"],"sources":["/Users/ryotarooda/Desktop/卒論/TuringChats/turing-chat-d/turing-chat-d11/frontend/src/services/firebase-realtime-database.ts"],"sourcesContent":["import { ref, push, get, onValue, remove } from \"firebase/database\";\nimport { auth } from \"./firebase_f.ts\"; // Firebaseの認証インスタンスをインポート\nimport { db } from \"./firebase_f.ts\"; // Firebase初期化ファイルからデータベースをインポート\nimport { RoomData } from \"shared/dist/types\";\n\n// test_dataを取得する関数\nexport const getTestData = async (): Promise<any> => {\n  try {\n    const testDataRef = db.ref(\"test_data\"); // 'test_data'ノードを参照\n    const snapshot = await testDataRef.once(\"value\"); // データを取得\n    if (snapshot.exists()) {\n      return snapshot.val(); // データが存在すればその内容を返す\n    } else {\n      console.log(\"test_dataが見つかりません。\");\n      return null;\n    }\n  } catch (error) {\n    console.error(\"test_dataの取得中にエラーが発生しました:\", error);\n    return null;\n  }\n};\n\n// ルームのデータを監視\nexport const onRoomUpdate = (\n  roomId: string,\n  callback: (roomData: RoomData | null) => void\n) => {\n  const roomRef = ref(db, `rooms/${roomId}`);\n  onValue(\n    roomRef,\n    (snapshot) => {\n      const roomData = snapshot.val() as RoomData | null; // RoomData型にキャスト\n      if (roomData) {\n        callback(roomData); // データがある場合はコールバックを呼び出す\n      } else {\n        console.error(\"ルームが存在しません。\");\n        callback(null);\n      }\n    },\n    (error) => {\n      console.error(\"ルームデータの監視中にエラーが発生しました:\", error);\n      callback(null);\n    }\n  );\n};\n\n// ルームデータを取得する関数\nexport const getRoomData = async (roomId: string): Promise<RoomData | null> => {\n  try {\n    const roomRef = ref(db, `rooms/${roomId}`);\n    const snapshot = await get(roomRef);\n\n    if (snapshot.exists()) {\n      const roomData = snapshot.val();\n      return roomData as RoomData; // RoomData型にキャストして返す\n    } else {\n      console.error(\"ルームが存在しません\");\n      return null;\n    }\n  } catch (error) {\n    console.error(\"ルームデータの取得に失敗しました:\", error);\n    return null;\n  }\n};\n\n// メッセージを送信する関数\nexport const sendMessage = async (roomId: string, message: string) => {\n  const user = auth.currentUser;\n  if (!user) {\n    throw new Error(\"ログインしていないユーザーです。\");\n  }\n\n  const messageRef = ref(db, `rooms/${roomId}/messages`);\n  const messageData = {\n    senderId: user.uid,\n    message,\n    timestamp: Date.now(),\n  };\n\n  await push(messageRef, messageData);\n  console.log(\"メッセージを送信しました。\");\n};\n\n// バトルログの更新を監視するリスナー\nexport const onTurnUpdated = (\n  roomId: string,\n  callback: (data: any) => void\n) => {\n  const battleLogRef = ref(db, `rooms/${roomId}/battleLog`);\n\n  // バトルログの更新をリアルタイムで監視\n  onValue(battleLogRef, (snapshot) => {\n    const battleLogData = snapshot.val();\n    if (battleLogData) {\n      callback(battleLogData); // バトルログが更新されたらコールバックを実行\n    }\n  });\n};\n\n// バトル終了を監視するリスナー\nexport const onBattleEnd = (roomId: string, callback: () => void) => {\n  const statusRef = ref(db, `rooms/${roomId}/status`);\n\n  // バトルの終了を監視\n  onValue(statusRef, (snapshot) => {\n    const status = snapshot.val();\n    if (status === \"ended\") {\n      callback(); // バトルが終了したらコールバックを実行\n    }\n  });\n};\n\n// マッチング成立時、マッチングがキャンセルされた場合やリロード時にwaitingPlayersから削除する関数\nexport const removeFromWaitingList = async () => {\n  const user = auth.currentUser;\n  if (!user) {\n    throw new Error(\"ログインしていないユーザーです。\");\n  }\n\n  const playerId = user.uid;\n  const playerRef = ref(db, \"waitingPlayers/\" + playerId);\n  await remove(playerRef); // 待機リストからプレイヤーを削除\n  console.log(\"プレイヤーを待機リストから削除しました。\");\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}