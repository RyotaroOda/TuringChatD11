{"ast":null,"code":"// services/firebase-functions-client.ts\nimport{httpsCallable}from\"firebase/functions\";import{auth,functions}from\"./firebase_f.ts\";// Firebase初期化ファイルをインポート\n// サーバーレス関数を使ってマッチングリクエストを送信する関数\nexport const requestMatch=async player=>{const requestMatchFunction=httpsCallable(functions,\"requestMatchFunction\");const TIMEOUT_DURATION=60000;// 60秒待機してもマッチングしなければタイムアウト\nlet timeoutId;try{const result=await new Promise((resolve,reject)=>{timeoutId=setTimeout(()=>reject({message:\"マッチングタイムアウト\"}),TIMEOUT_DURATION);requestMatchFunction(player).then(response=>{clearTimeout(timeoutId);// タイムアウトをクリア\nresolve(response.data);}).catch(error=>{clearTimeout(timeoutId);// タイムアウトをクリア\nreject({message:error.message});});});return result;}catch(error){console.error(\"マッチングエラーまたはタイムアウト:\",error);return{roomId:\"\",startBattle:false};}};// サーバーレス関数を使ってマッチングキャンセルを行う関数\nexport const cancelMatch=async()=>{const user=auth.currentUser;if(!user){throw new Error(\"ログインしていないユーザーです。\");}const cancelMatchFunction=httpsCallable(functions,\"cancelMatchFunction\");const result=await cancelMatchFunction();return result.data;};","map":{"version":3,"names":["httpsCallable","auth","functions","requestMatch","player","requestMatchFunction","TIMEOUT_DURATION","timeoutId","result","Promise","resolve","reject","setTimeout","message","then","response","clearTimeout","data","catch","error","console","roomId","startBattle","cancelMatch","user","currentUser","Error","cancelMatchFunction"],"sources":["/Users/ryotarooda/Desktop/卒論/TuringChats/turing-chat-d/turing-chat-d11/frontend/src/services/firebase-functions-client.ts"],"sourcesContent":["// services/firebase-functions-client.ts\nimport { httpsCallable } from \"firebase/functions\";\nimport { auth, functions } from \"./firebase_f.ts\"; // Firebase初期化ファイルをインポート\nimport { PlayerData, MatchResult } from \"../shared/types.ts\";\n\n// サーバーレス関数を使ってマッチングリクエストを送信する関数\nexport const requestMatch = async (\n  player: PlayerData\n): Promise<{ roomId: string; startBattle: Boolean }> => {\n  const requestMatchFunction = httpsCallable(functions, \"requestMatchFunction\");\n\n  const TIMEOUT_DURATION = 60000; // 60秒待機してもマッチングしなければタイムアウト\n  let timeoutId;\n\n  try {\n    const result: MatchResult = await new Promise((resolve, reject) => {\n      timeoutId = setTimeout(\n        () => reject({ message: \"マッチングタイムアウト\" }),\n        TIMEOUT_DURATION\n      );\n      requestMatchFunction(player)\n        .then((response) => {\n          clearTimeout(timeoutId); // タイムアウトをクリア\n          resolve(response.data as MatchResult);\n        })\n        .catch((error) => {\n          clearTimeout(timeoutId); // タイムアウトをクリア\n          reject({ message: error.message });\n        });\n    });\n\n    return result;\n  } catch (error) {\n    console.error(\"マッチングエラーまたはタイムアウト:\", error);\n    return { roomId: \"\", startBattle: false };\n  }\n};\n\n// サーバーレス関数を使ってマッチングキャンセルを行う関数\nexport const cancelMatch = async () => {\n  const user = auth.currentUser;\n  if (!user) {\n    throw new Error(\"ログインしていないユーザーです。\");\n  }\n\n  const cancelMatchFunction = httpsCallable<{ rating: number }, MatchResult>(\n    functions,\n    \"cancelMatchFunction\"\n  );\n  const result = await cancelMatchFunction();\n  return result.data;\n};\n"],"mappings":"AAAA;AACA,OAASA,aAAa,KAAQ,oBAAoB,CAClD,OAASC,IAAI,CAAEC,SAAS,KAAQ,iBAAiB,CAAE;AAGnD;AACA,MAAO,MAAM,CAAAC,YAAY,CAAG,KAC1B,CAAAC,MAAkB,EACoC,CACtD,KAAM,CAAAC,oBAAoB,CAAGL,aAAa,CAACE,SAAS,CAAE,sBAAsB,CAAC,CAE7E,KAAM,CAAAI,gBAAgB,CAAG,KAAK,CAAE;AAChC,GAAI,CAAAC,SAAS,CAEb,GAAI,CACF,KAAM,CAAAC,MAAmB,CAAG,KAAM,IAAI,CAAAC,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACjEJ,SAAS,CAAGK,UAAU,CACpB,IAAMD,MAAM,CAAC,CAAEE,OAAO,CAAE,aAAc,CAAC,CAAC,CACxCP,gBACF,CAAC,CACDD,oBAAoB,CAACD,MAAM,CAAC,CACzBU,IAAI,CAAEC,QAAQ,EAAK,CAClBC,YAAY,CAACT,SAAS,CAAC,CAAE;AACzBG,OAAO,CAACK,QAAQ,CAACE,IAAmB,CAAC,CACvC,CAAC,CAAC,CACDC,KAAK,CAAEC,KAAK,EAAK,CAChBH,YAAY,CAACT,SAAS,CAAC,CAAE;AACzBI,MAAM,CAAC,CAAEE,OAAO,CAAEM,KAAK,CAACN,OAAQ,CAAC,CAAC,CACpC,CAAC,CAAC,CACN,CAAC,CAAC,CAEF,MAAO,CAAAL,MAAM,CACf,CAAE,MAAOW,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,oBAAoB,CAAEA,KAAK,CAAC,CAC1C,MAAO,CAAEE,MAAM,CAAE,EAAE,CAAEC,WAAW,CAAE,KAAM,CAAC,CAC3C,CACF,CAAC,CAED;AACA,MAAO,MAAM,CAAAC,WAAW,CAAG,KAAAA,CAAA,GAAY,CACrC,KAAM,CAAAC,IAAI,CAAGvB,IAAI,CAACwB,WAAW,CAC7B,GAAI,CAACD,IAAI,CAAE,CACT,KAAM,IAAI,CAAAE,KAAK,CAAC,kBAAkB,CAAC,CACrC,CAEA,KAAM,CAAAC,mBAAmB,CAAG3B,aAAa,CACvCE,SAAS,CACT,qBACF,CAAC,CACD,KAAM,CAAAM,MAAM,CAAG,KAAM,CAAAmB,mBAAmB,CAAC,CAAC,CAC1C,MAAO,CAAAnB,MAAM,CAACS,IAAI,CACpB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}