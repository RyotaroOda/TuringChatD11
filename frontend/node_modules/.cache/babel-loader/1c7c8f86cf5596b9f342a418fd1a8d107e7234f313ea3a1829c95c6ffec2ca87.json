{"ast":null,"code":"// services/firebase-functions-client.ts\nimport { httpsCallable } from \"firebase/functions\";\nimport { auth, functions } from \"./firebase_f.ts\"; // Firebase初期化ファイルをインポート\n\n// サーバーレス関数を使ってマッチングリクエストを送信する関数\nexport const requestMatch = async player => {\n  const requestMatchFunction = httpsCallable(functions, \"requestMatchFunction\");\n  const TIMEOUT_DURATION = 60000; // 60秒待機してもマッチングしなければタイムアウト\n  let timeoutId;\n  try {\n    const result = await new Promise((resolve, reject) => {\n      timeoutId = setTimeout(() => reject({\n        message: \"マッチングタイムアウト\"\n      }), TIMEOUT_DURATION);\n      requestMatchFunction(player).then(response => {\n        clearTimeout(timeoutId); // タイムアウトをクリア\n        resolve(response.data);\n      }).catch(error => {\n        clearTimeout(timeoutId); // タイムアウトをクリア\n        reject({\n          message: error.message\n        });\n      });\n    });\n    return result;\n  } catch (error) {\n    console.error(\"マッチングエラーまたはタイムアウト:\", error);\n    return {\n      roomId: \"\",\n      startBattle: false\n    };\n  }\n};\n\n// サーバーレス関数を使ってマッチングキャンセルを行う関数\nexport const cancelMatch = async () => {\n  const user = auth.currentUser;\n  if (!user) {\n    throw new Error(\"ログインしていないユーザーです。\");\n  }\n  const cancelMatchFunction = httpsCallable(functions, \"cancelMatchFunction\");\n  const result = await cancelMatchFunction();\n  return result.data;\n};","map":{"version":3,"names":["httpsCallable","auth","functions","requestMatch","player","requestMatchFunction","TIMEOUT_DURATION","timeoutId","result","Promise","resolve","reject","setTimeout","message","then","response","clearTimeout","data","catch","error","console","roomId","startBattle","cancelMatch","user","currentUser","Error","cancelMatchFunction"],"sources":["/Users/ryotarooda/Desktop/卒論/TuringChats/turing-chat-d/turing-chat-d11/frontend/src/services/firebase-functions-client.ts"],"sourcesContent":["// services/firebase-functions-client.ts\nimport { httpsCallable } from \"firebase/functions\";\nimport { auth, functions } from \"./firebase_f.ts\"; // Firebase初期化ファイルをインポート\nimport { PlayerData, MatchResult } from \"../shared/types.ts\";\n\n// サーバーレス関数を使ってマッチングリクエストを送信する関数\nexport const requestMatch = async (\n  player: PlayerData\n): Promise<{ roomId: string; startBattle: Boolean }> => {\n  const requestMatchFunction = httpsCallable(functions, \"requestMatchFunction\");\n\n  const TIMEOUT_DURATION = 60000; // 60秒待機してもマッチングしなければタイムアウト\n  let timeoutId;\n\n  try {\n    const result: MatchResult = await new Promise((resolve, reject) => {\n      timeoutId = setTimeout(\n        () => reject({ message: \"マッチングタイムアウト\" }),\n        TIMEOUT_DURATION\n      );\n      requestMatchFunction(player)\n        .then((response) => {\n          clearTimeout(timeoutId); // タイムアウトをクリア\n          resolve(response.data as MatchResult);\n        })\n        .catch((error) => {\n          clearTimeout(timeoutId); // タイムアウトをクリア\n          reject({ message: error.message });\n        });\n    });\n\n    return result;\n  } catch (error) {\n    console.error(\"マッチングエラーまたはタイムアウト:\", error);\n    return { roomId: \"\", startBattle: false };\n  }\n};\n\n// サーバーレス関数を使ってマッチングキャンセルを行う関数\nexport const cancelMatch = async () => {\n  const user = auth.currentUser;\n  if (!user) {\n    throw new Error(\"ログインしていないユーザーです。\");\n  }\n\n  const cancelMatchFunction = httpsCallable<{ rating: number }, MatchResult>(\n    functions,\n    \"cancelMatchFunction\"\n  );\n  const result = await cancelMatchFunction();\n  return result.data;\n};\n"],"mappings":"AAAA;AACA,SAASA,aAAa,QAAQ,oBAAoB;AAClD,SAASC,IAAI,EAAEC,SAAS,QAAQ,iBAAiB,CAAC,CAAC;;AAGnD;AACA,OAAO,MAAMC,YAAY,GAAG,MAC1BC,MAAkB,IACoC;EACtD,MAAMC,oBAAoB,GAAGL,aAAa,CAACE,SAAS,EAAE,sBAAsB,CAAC;EAE7E,MAAMI,gBAAgB,GAAG,KAAK,CAAC,CAAC;EAChC,IAAIC,SAAS;EAEb,IAAI;IACF,MAAMC,MAAmB,GAAG,MAAM,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACjEJ,SAAS,GAAGK,UAAU,CACpB,MAAMD,MAAM,CAAC;QAAEE,OAAO,EAAE;MAAc,CAAC,CAAC,EACxCP,gBACF,CAAC;MACDD,oBAAoB,CAACD,MAAM,CAAC,CACzBU,IAAI,CAAEC,QAAQ,IAAK;QAClBC,YAAY,CAACT,SAAS,CAAC,CAAC,CAAC;QACzBG,OAAO,CAACK,QAAQ,CAACE,IAAmB,CAAC;MACvC,CAAC,CAAC,CACDC,KAAK,CAAEC,KAAK,IAAK;QAChBH,YAAY,CAACT,SAAS,CAAC,CAAC,CAAC;QACzBI,MAAM,CAAC;UAAEE,OAAO,EAAEM,KAAK,CAACN;QAAQ,CAAC,CAAC;MACpC,CAAC,CAAC;IACN,CAAC,CAAC;IAEF,OAAOL,MAAM;EACf,CAAC,CAAC,OAAOW,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,oBAAoB,EAAEA,KAAK,CAAC;IAC1C,OAAO;MAAEE,MAAM,EAAE,EAAE;MAAEC,WAAW,EAAE;IAAM,CAAC;EAC3C;AACF,CAAC;;AAED;AACA,OAAO,MAAMC,WAAW,GAAG,MAAAA,CAAA,KAAY;EACrC,MAAMC,IAAI,GAAGvB,IAAI,CAACwB,WAAW;EAC7B,IAAI,CAACD,IAAI,EAAE;IACT,MAAM,IAAIE,KAAK,CAAC,kBAAkB,CAAC;EACrC;EAEA,MAAMC,mBAAmB,GAAG3B,aAAa,CACvCE,SAAS,EACT,qBACF,CAAC;EACD,MAAMM,MAAM,GAAG,MAAMmB,mBAAmB,CAAC,CAAC;EAC1C,OAAOnB,MAAM,CAACS,IAAI;AACpB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}